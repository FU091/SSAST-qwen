# 1. 決定地基
FROM python:3.8-slim

# 2. 安裝「系統」工具
#    您的 requirements.txt 裡有 librosa (處理音訊)，
#    而 librosa 在讀取某些音訊檔時「需要」ffmpeg。
#    少了這一步，您的 Python 程式在「執行時」(Runtime) 可能會出錯。
RUN apt-get update && apt-get install -y \
    ffmpeg \
    && rm -rf /var/lib/apt/lists/*

# 3. 設定工作資料夾
WORKDIR /ssast

# 4. 把「軟體清單」複製進來
COPY requirements.txt .

# 5. 執行安裝程式
#    (多加了 --upgrade pip，確保 pip 是最新的，避免安裝失敗)
RUN pip install --upgrade pip && \
    pip install -r requirements.txt

# 6. 複製整個 SSAST 專案
#    複製 ssast-main 資料夾到容器中的 /ssast 目錄
COPY ssast-main/ /ssast/

# 7. 設定入口點
#    預設執行路徑，但可以透過 docker run 參數覆蓋
WORKDIR /ssast

# 8. 設定執行指令
#    預設執行 run.py，但可以透過 docker run 參數指定其他參數
CMD ["python", "src/run.py"]